<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Tickets</title>
  <link rel="icon" type="image/png" href="picture/favicon.png">
  <link rel="stylesheet" href="style.css">
</head>

<body data-guard="admin">
  <canvas id="stars"></canvas>
  <header class="topbar">
    <div class="topbar-inner">
      <div>
        <h1 class="brand" style="margin-bottom:0; line-height:1;">Support <span>Admin</span></h1>
        <div id="user-display" style="font-size: 13px; opacity: 0.7; font-weight:normal;"></div>
      </div>
      <div class="hero-actions">
        <button id="btn-to-dash" class="btn-ghost" onclick="window.location.href='dashboard.html'">ğŸ  Dashboard</button>
        <button id="btn-archive" class="btn-ghost">ğŸ—„ï¸ Archiv</button>
        <button id="theme-toggle" class="btn-ghost">ğŸŒ™</button>
        <button id="logout" class="btn-ghost">Logout</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Archive View -->
    <div id="archive-view" class="archive-view">
      <div class="archive-header">
        <h3>ğŸ—„ï¸ Archivierte Tickets</h3>
        <button id="btn-back-kanban" class="btn-secondary">ZurÃ¼ck zur Ãœbersicht</button>
      </div>
      <div id="archive-list" class="archived-list"></div>
    </div>

    <div id="kanban-view">
      <!-- Requests Section -->
      <div style="margin-bottom: 30px;" class="card glass">
        <h3 style="margin-bottom:15px; border-bottom:1px solid var(--border); padding-bottom:10px;">Konto-Anfragen</h3>
        <div id="request-list"
          style="display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap:15px;"></div>
      </div>

      <div class="kanban-board">
        <!-- New Column -->
        <div class="column" id="col-new">
          <div class="col-header">
            <span>ğŸ†• Neu</span>
            <span class="count" id="count-new">0</span>
          </div>
          <div class="ticket-list" data-status="Neu" id="list-new"></div>
        </div>

        <!-- In Progress Column -->
        <div class="column" id="col-doing">
          <div class="col-header">
            <span>ğŸ”§ In Bearbeitung</span>
            <span class="count" id="count-doing">0</span>
          </div>
          <div class="ticket-list" data-status="In Bearbeitung" id="list-doing"></div>
        </div>

        <!-- Done Column -->
        <div class="column" id="col-done">
          <div class="col-header">
            <span>âœ… Geschlossen</span>
            <span class="count" id="count-done">0</span>
          </div>
          <div class="ticket-list" data-status="Geschlossen" id="list-done"></div>
        </div>
      </div>
    </div>
  </main>

  <!-- Ticket Detail Modal -->
  <div class="modal-overlay" id="ticket-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 id="m-title">Ticket Title</h3>
        <button class="btn-ghost" id="m-close">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="tabs">
          <div class="tab-btn active" data-tab="details">Details</div>
          <div class="tab-btn" data-tab="chat">Chat</div>
        </div>

        <div id="tab-details" class="tab-content active">
          <div class="ticket-meta-grid"
            style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:20px; font-size:13px; color:var(--text-sec); background:var(--card-hover); padding:15px; border-radius:8px;">
            <div><strong>Von:</strong> <span id="m-author" style="color:var(--text)">-</span></div>
            <div><strong>Datum:</strong> <span id="m-date" style="color:var(--text)">-</span></div>
            <div><strong>Prio:</strong> <span id="m-prio" style="color:var(--text)">-</span></div>
            <div><strong>Kategorie:</strong> <span id="m-cat" style="color:var(--text)">-</span></div>
          </div>

          <h4 style="margin-bottom:8px; font-size:12px; text-transform:uppercase; opacity:0.7;">Beschreibung</h4>
          <p id="m-desc" style="white-space:pre-wrap; margin-bottom:20px; line-height:1.5;"></p>
          <div class="field">
            <label>Zuweisung (Mehrfachauswahl mÃ¶glich):</label>
            <div class="multi-select-container" id="assignee-multi">
              <div class="multi-select-header" id="ms-header"><span class="ms-text">Niemand</span></div>
              <div class="multi-select-dropdown" id="ms-dropdown"></div>
            </div>
          </div>

          <!-- Internal Comments Section (Restored) -->
          <div class="comments-section"
            style="margin-top: 20px; border-top: 1px solid var(--border); padding-top: 15px;">
            <h4>Interne Notizen / Kommentare</h4>
            <div id="m-comments" style="max-height: 150px; overflow-y: auto; margin-bottom: 10px;"></div>
            <div class="field">
              <textarea id="m-new-comment" rows="2" placeholder="Kommentar hinzufÃ¼gen..."></textarea>
              <button class="btn-primary" id="btn-add-comment"
                style="margin-top: 5px; font-size: 12px; padding: 6px 12px;">Kommentieren</button>
            </div>
          </div>

          <div style="margin-top:20px; text-align:right;">
            <button id="btn-archive-ticket" class="btn-secondary" style="display:none; font-size:12px;">ğŸ“¥
              Archivieren</button>
          </div>
        </div>

        <div id="tab-chat" class="tab-content">
          <div class="chat-container">
            <div id="m-chat-msgs" class="chat-messages">
              <!-- Chat Bubbles go here -->
            </div>
            <!-- Controls -->
            <div class="chat-input-area">
              <div class="toolbar">
                <button class="tool-btn" title="Fett" id="m-chat-bold"><b>B</b></button>
                <button class="tool-btn" title="Kursiv" id="m-chat-italic"><i>I</i></button>
                <label class="tool-btn" title="Datei anhÃ¤ngen" style="cursor:pointer;">
                  ğŸ“ <input type="file" id="m-chat-file-input" style="display:none" multiple>
                </label>
              </div>
              <div id="m-chat-file-preview"
                style="display:none; gap:5px; flex-wrap:wrap; padding-bottom:8px; border-bottom:1px solid var(--border); margin-bottom:8px;">
              </div>

              <div class="input-row">
                <textarea id="m-chat-input" placeholder="Nachricht schreiben... Strg+Enter zum Senden"></textarea>
                <button class="btn-primary" id="btn-chat-send">â¤</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-ghost" id="m-close-bt">SchlieÃŸen</button>
      </div>
    </div>
  </div>

  <!-- Approve User Modal -->
  <div class="modal-overlay" id="approve-modal">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h3>Benutzer erstellen</h3>
        <button class="btn-ghost" id="a-close">âœ•</button>
      </div>
      <div class="modal-body">
        <p>Erstelle einen Account fÃ¼r <strong id="a-name-disp"></strong>.</p>
        <div class="field">
          <label>Benutzername</label>
          <input type="text" id="a-username" placeholder="z.b. maxm">
        </div>
        <div class="field">
          <label>Passwort</label>
          <input type="text" id="a-password" value="123">
        </div>
        <div class="field">
          <label>Rolle</label>
          <select id="a-role">
            <option value="user">User</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <div class="field" id="a-dept-field" style="display:none;">
          <label>Abteilung (Nur fÃ¼r Admins)</label>
          <select id="a-dept">
            <option value="Allgemein">Allgemein</option>
            <option value="Technik">Technik</option>
            <option value="Account">Account</option>
            <option value="Abrechnung">Abrechnung</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-ghost" id="a-cancel">Abbrechen</button>
        <button class="btn-primary" id="a-confirm">Erstellen</button>
      </div>
    </div>
  </div>

  <!-- Superadmin: User Manager Modal -->
  <div class="modal-overlay" id="user-man-modal">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h3>Benutzerverwaltung</h3>
        <button class="btn-ghost" id="um-close">âœ•</button>
      </div>
      <div class="modal-body" style="max-height:60vh; overflow-y:auto;">
        <div id="um-list" class="user-list"></div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>

</html>